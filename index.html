<meta charset="utf-8">
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://d3js.org/d3.v3.js"></script>
<title>US Unemployment Visualizations</title>
</head>
<style>
  html {
    height: 100%;
  }
  body, table {
    font: 12px Arial;
  }
  h4 {
    margin-top: 0px;
    margin-bottom: 5px;
  }
  .inactive {
    fill: #AAA;
  }
  .active {
    fill: orange;
  }
  #unemploymentCharts { 
    float:left;
    width: 60%;
    height: 95%;
    margin: 0px 0px 0px 0.6%;
    padding: 10px;
    border-style: solid;
    border-color: #AAA;
    overflow-y: scroll;
  }
  #options { 
    float:right;
    width: 35%;
    height: 95%;
    padding: 10px;
  }
  #stateOptions {
    height: 200px;
    width: 35%;
    float: left;
    border-style: solid;
    border-color: #CCC;
    overflow-y: scroll;
    margin: 0px 5px 5px 0px;
  }
  #comparisonOptions {
    float: left;
    width: 50%;
    margin: 0 auto;
  }
  #timeOptions {
    float: left;
    width: 50%;
    margin-bottom: 7px;
  }
  #usMap {
    width:100%;
    display: inline-block;
  }
</style>

<body>
  <!-- Where the unemployment visualization svgs go -->
  <div id="unemploymentCharts">
  </div>
  
  <!-- All the options for the visualization (states, years, etc.) -->
  <div id="options">
    <h1>US Unemployment Visualization</h1>
    <p>Click to delete.</p>
    <h4>States shown:</h4>
    <div id="stateOptions">
      <!-- State checkboxes -->
      <input type="checkbox" id ="all" name="stateSelection" onClick=selectAll(this)> Select All<br>
      <input type="checkbox" id="alabama" name="stateSelection"> Alabama<br>
      <input type="checkbox" id="texas" name="stateSelection" value="Texas"> Texas<br>
      <input type="checkbox" id="wyoming" name="stateSelection"> Wyoming<br>
    </div>
    <div id="timeOptions">
      <h4>Time Period:</h4>
      <table>
        <tr>
          <td>
            From: &ensp;
          </td>
          <td>
            <select class="timePeriodSelector" name="month">
              <option value="1">Jan</option>
              <option value="2">Feb</option>
              <option value="3">Mar</option>
              <option value="4">Apr</option>
              <option value="5">May</option>
              <option value="6">Jun</option>
              <option value="7">Jul</option>
              <option value="8">Aug</option>
              <option value="9">Sep</option>
              <option value="10">Oct</option>
              <option value="11">Nov</option>
              <option value="12">Dec</option>
            </select>
            <select class="timePeriodSelector" name="year">
              <option value="1978">1978</option>
              <option value="2016">2016</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>To: &emsp;&ensp;</td>
          <td>
            <select class="timePeriodSelector" name="month">
              <option value="1">Jan</option>
              <option value="2">Feb</option>
              <option value="3">Mar</option>
              <option value="4">Apr</option>
              <option value="5">May</option>
              <option value="6">Jun</option>
              <option value="7">Jul</option>
              <option value="8">Aug</option>
              <option value="9">Sep</option>
              <option value="10">Oct</option>
              <option value="11">Nov</option>
              <option value="12">Dec</option>
            </select>
            <select class="timePeriodSelector" name="year">
              <option value="1978">1978</option>
              <option value="2016">2016</option>
            </select>
          </td>
        </tr>
      </table>
    </div>
    <div id="comparisonOptions">
      <h4>Compare to:</h4>
      <input type="radio" name="comparison" value="none" checked> No Comparison<br>
      <input type="radio" name="comparison" value="state" display="inline"> State:
      <br>&emsp;&emsp;
      <select class="stateComparisonOptions" name="states" disabled>
        <option value="texas">Texas</option>
        <option value="nationalAverage">National Average</option>
      </select>
      <br>
      <input type="radio" name="comparison" value="years"> Years:
      <br>&emsp;&emsp;
      <select class="yearComparisonOptions" name="years" disabled>
        <option value="1978">1978</option>
        <option value="2016">2016</option>
      </select>
      &ensp;and&ensp;
      <select class="yearComparisonOptions" name="years" disabled>
        <option value="1978">1978</option>
        <option value="2016">2016</option>
      </select>
      <br>
    </div>
    <div id="usMap">
      <svg></svg>
    </div>
    
  </div>
  
  <script type="text/javascript">
    // US map drawing.
    //Width and height of map
    var width = $("#usMap").width();
    var height = 300;

    // D3 Projection
    var projection = d3.geo.albersUsa()
                       .translate([width/2, height/2])    // translate to center of screen
                       .scale([width]);          // scale things down so see entire US

    // Define path generator
    var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
                 .projection(projection);  // tell path generator to use albersUsa projection
    
    //Create SVG element and append map to the SVG
    var mapSvg = d3.select("#usMap")
                .select("svg")
                .attr("width", width)
                .attr("height", height);
    
    mapSvg.append("rect")
      .attr("class", "background")
      .attr("width", width)
      .attr("height", height)
      .style("fill", "#FFF")
      .on("click", mapBackgroundClick);
    
    d3.json("us-states.json", function(json) {
      
    // Bind the data to the SVG and create one path per GeoJSON feature
    mapSvg.selectAll("path")
        .data(json.features)
        .enter()
        .append("path")
        .attr("d", path)
        .style("stroke", "#fff")
        .style("stroke-width", "1")
        .classed("inactive", true)
        .on("mouseover", mapMouseOver)
        .on("mouseout", mapMouseOut)
        .on("click", mapClick);
    });
    
    function mapMouseOver() {
      d3.select(this).style("opacity","0.7");
    }
    
    function mapMouseOut() {
      d3.select(this).style("opacity","1");
    }
    
    function mapClick() {
      var _this = d3.select(this);
      var active = _this.classed("active");
      
      _this.classed("active", !active);
      _this.classed("inactive", active);
    }
    
    function mapBackgroundClick() {
      mapSvg.selectAll("path").classed("inactive", true);
      mapSvg.selectAll("path").classed("active", false);
    }
    
    $(document.getElementsByName("comparison")).on("click", function() {
      var _this = this;
      if (_this.value == "state") {
        $(".stateComparisonOptions").attr("disabled", false);
        $(".yearComparisonOptions").attr("disabled", true);
        $(".timePeriodSelector").attr("disabled", false);
      } else if (_this.value == "years") {
        $(".stateComparisonOptions").attr("disabled", true);
        $(".yearComparisonOptions").attr("disabled", false);
        $(".timePeriodSelector").attr("disabled", true);
      } else {
        $(".stateComparisonOptions").attr("disabled", true);
        $(".yearComparisonOptions").attr("disabled", true);
        $(".timePeriodSelector").attr("disabled", false);
      }
    });
    
    function selectAll(_this) {
      checkboxes = document.getElementsByName(_this.name);
      for(var i=0, n=checkboxes.length;i<n;i++) {
        checkboxes[i].checked = _this.checked;
      }
    }

    
    //Width and height
    var w = $("#unemploymentCharts").width() * 0.95;
    var h = 100;
    var barPadding = 1;

    var dataset1 = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
                    11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
    var dataset2 = [20, 10, 13,  2, 21, 25, 22, 18, 15, 13,
                    11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
    
    var chartArray = [dataset1, dataset1, dataset1, dataset1, dataset1, dataset1, dataset1, dataset1, dataset1, dataset1, dataset1];
    
    d3.select("#unemploymentCharts").selectAll("svg")
      .data(chartArray)
      .enter()
      .append("svg")
      .style("display", "block")
      .attr("width", w)
      .attr("height", h)
      .style("margin-top", 2);

    //Create SVG element
    var svg1 = d3.select("#unemploymentCharts")
                .append("svg")
                .style("display", "block")
                .attr("width", w)
                .attr("height", h);

    var svg2 = d3.select("#unemploymentCharts")
                .append("svg")
                .style("display", "block")
                .attr("width", w)
                .attr("height", h)
                .style("margin-top", 2);

    svg1.selectAll("rect")
       .data(dataset1)
       .enter()
       .append("rect")
       .attr("x", function(d, i) {
            return i * (w / dataset1.length);
       })
       .attr("y", function(d) {
            return h - (d * 4);
       })
       .attr("width", w / dataset1.length - barPadding)
       .attr("height", function(d) {
            return d * 4;
       })
       .attr("fill", function(d) {
            return "rgb(0, 0, " + (d * 10) + ")";
       });

    svg1.selectAll("text")
       .data(dataset1)
       .enter()
       .append("text")
       .text(function(d) {
            return d;
       })
       .attr("text-anchor", "middle")
       .attr("x", function(d, i) {
            return i * (w / dataset1.length) + (w / dataset1.length - barPadding) / 2;
       })
       .attr("y", function(d) {
            return h - (d * 4) + 14;
       })
       .attr("font-family", "sans-serif")
       .attr("font-size", "11px")
       .attr("fill", "white");

    svg2.selectAll("rect")
       .data(dataset2)
       .enter()
       .append("rect")
       .attr("x", function(d, i) {
            return i * (w / dataset2.length);
       })
       .attr("y", function(d) {
            return h - (d * 4);
       })
       .attr("width", w / dataset2.length - barPadding)
       .attr("height", function(d) {
            return d * 4;
       })
       .attr("fill", function(d) {
            return "rgb(0, 0, " + (d * 10) + ")";
       });

    svg2.selectAll("text")
       .data(dataset2)
       .enter()
       .append("text")
       .text(function(d) {
            return d;
       })
       .attr("text-anchor", "middle")
       .attr("x", function(d, i) {
            return i * (w / dataset2.length) + (w / dataset2.length - barPadding) / 2;
       })
       .attr("y", function(d) {
            return h - (d * 4) + 14;
       })
       .attr("font-family", "sans-serif")
       .attr("font-size", "11px")
       .attr("fill", "white");

    d3.select("p")
        .on("click", function() {
            svg1.transition().duration(1500)
            .attr("height", 0)
            .remove();
        });



</script>
</body>